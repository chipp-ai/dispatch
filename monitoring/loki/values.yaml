# Loki Helm values -- monolithic mode with GCS backend
# Chart: grafana/loki

deploymentMode: SingleBinary

loki:
  auth_enabled: false

  storage:
    type: gcs
    bucketNames:
      chunks: chippai-398019-loki-logs
      ruler: chippai-398019-loki-logs
    gcs:
      chunkBufferSize: 0

  schemaConfig:
    configs:
      - from: "2025-01-01"
        store: tsdb
        object_store: gcs
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

  limits_config:
    retention_period: 720h  # 30 days
    max_query_series: 500
    max_query_parallelism: 2

  compactor:
    working_directory: /var/loki/compactor
    retention_enabled: true
    delete_request_store: gcs

  commonConfig:
    replication_factor: 1

  ingester:
    chunk_encoding: snappy

singleBinary:
  replicas: 1
  # Explicit empty podAntiAffinity overrides chart's hard default (Autopilot compat)
  affinity:
    podAntiAffinity: null
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 1
      memory: 2Gi
  persistence:
    enabled: true
    size: 10Gi
    storageClass: standard-rwo
  extraVolumes:
    - name: gcs-credentials
      secret:
        secretName: loki-gcs-credentials
  extraVolumeMounts:
    - name: gcs-credentials
      mountPath: /etc/gcs
      readOnly: true
  extraEnv:
    - name: GOOGLE_APPLICATION_CREDENTIALS
      value: /etc/gcs/gcs-key.json

gateway:
  replicas: 1
  # Explicit empty podAntiAffinity overrides chart's hard default (Autopilot compat)
  affinity:
    podAntiAffinity: null
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Disable components we don't need
backend:
  replicas: 0
read:
  replicas: 0
write:
  replicas: 0

chunksCache:
  enabled: false
resultsCache:
  enabled: false

lokiCanary:
  enabled: false
test:
  enabled: false

monitoring:
  selfMonitoring:
    enabled: false
    grafanaAgent:
      installOperator: false
  lokiCanary:
    enabled: false
